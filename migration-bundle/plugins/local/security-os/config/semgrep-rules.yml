rules:
  - id: supabase-service-key-client-side
    patterns:
      - pattern: createClient($URL, $KEY, ...)
      - metavariable-regex:
          metavariable: $KEY
          regex: .*SERVICE_ROLE.*
    message: "Service role key detected in client-side code. Use anon key for browser clients."
    severity: ERROR
    languages: [typescript, javascript]

  - id: nextjs-dangerous-html
    pattern: dangerouslySetInnerâ€‹HTML={{__html: $VAR}}
    message: "Potential XSS via dangerous innerHTML setter. Sanitize input first."
    severity: WARNING
    languages: [typescript, javascript]

  - id: env-secret-in-client-component
    patterns:
      - pattern: process.env.SUPABASE_SERVICE_ROLE_KEY
      - pattern-inside: |
          'use client'
          ...
    message: "Server-side env var accessed in client component. This will be undefined at runtime."
    severity: ERROR
    languages: [typescript, javascript]

  - id: hardcoded-url-with-credentials
    pattern-regex: "https?://[^:]+:[^@]+@"
    message: "URL contains embedded credentials. Use environment variables instead."
    severity: ERROR
    languages: [typescript, javascript]

  - id: console-log-sensitive
    patterns:
      - pattern: console.log(..., $VAR, ...)
      - metavariable-regex:
          metavariable: $VAR
          regex: .*(token|key|secret|password|credential).*
    message: "Potentially logging sensitive data. Remove before production."
    severity: WARNING
    languages: [typescript, javascript]

  - id: missing-auth-check-api-route
    patterns:
      - pattern: |
          export async function $METHOD(request: NextRequest) {
            ...
            $DB.from($TABLE).$OP(...)
            ...
          }
      - pattern-not: |
          export async function $METHOD(request: NextRequest) {
            ...
            request.headers.get(...)
            ...
          }
    message: "API route accesses database without checking authentication headers."
    severity: WARNING
    languages: [typescript]
